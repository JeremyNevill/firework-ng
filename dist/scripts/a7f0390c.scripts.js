"use strict";angular.module("fireworkNgApp",["ngCookies","ngResource","ngSanitize","ngRoute","azure-mobile-service.module","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"MainController"}).when("/timeline",{templateUrl:"views/timeline.html",controller:"MainController"}).when("/add",{templateUrl:"views/add.html",controller:"MainController"}).when("/edit/:itemId",{templateUrl:"views/edit.html",controller:"EditController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}],function(a){a.defaults.headers.common["X-ZUMO-APPLICATION"]="na",a.defaults.headers.common["Content-Type"]="Application/json"}),angular.module("azure-mobile-service.module",[]).service("Azureservice",["$q",function(a){var b="https://firework.azure-mobile.net/",c="",d=["google","twitter","facebook","windowsaccount","windowsazureactivedirectory"],e=WindowsAzure.MobileServiceClient,f=new e(b,c),g=function(){sessionStorage.loggedInUser&&(f.currentUser=JSON.parse(sessionStorage.loggedInUser))};g();var h=function(a){return f.getTable(a)},i=function(a){return"undefined"==typeof a||"object"!=typeof a&&"function"!=typeof a},j=function(a){return k(a)||"object"!=typeof a},k=function(a){return null===a||"undefined"==typeof a},l=function(a){return!k(a)},m=function(b){var c=a.defer();return b.done(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise};return{query:function(a,b){var c=null;if(k(a))return console.error("Azureservice.query: You must specify a table name"),null;if(angular.isDefined(b)&&angular.isObject(b)){if(i(b.criteria)&&(b.criteria={}),c=h(a).where(b.criteria,b.params),l(b.take)&&angular.isNumber(b.take)&&(c=c.take(b.take)),l(b.skip)&&angular.isNumber(b.take)&&(c=c.skip(b.skip)),angular.isDefined(b.orderBy)&&angular.isArray(b.orderBy))for(var d=b.orderBy,e=0;e<d.length;e++){var f=d[e].column,g=d[e].direction;angular.isDefined(f)&&(angular.isDefined(g)&&"desc"===g.toLowerCase()?c=c.orderByDescending(f):angular.isDefined(f)&&(c=c.orderBy(f)))}angular.isDefined(b.columns)&&angular.isArray(b.columns)&&(c=c.select(b.columns.join()))}else c=h(a).where({});return m(c.includeTotalCount().read())},getAll:function(a){return this.query(a)},insert:function(a,b){return k(a)?(console.error("Azureservice.insert: You must specify a table name"),null):j(b)?(console.error("Azureservice.insert: You must specify the insert object"),null):m(h(a).insert(b))},update:function(a,b){return k(a)?(console.error("Azureservice.update: You must specify a table name"),null):j(b)?(console.error("Azureservice.update: You must specify the insert object"),null):m(h(a).update(b))},getSingleItem:function(a,b){return k(a)?(console.error("Azureservice.update: You must specify a table name"),null):k(b)?(console.error("Azureservice.update: You must specify the id"),null):m(h(a).lookup(b))},del:function(a,b){return k(a)?(console.error("Azureservice.del: You must specify a table name"),null):j(b)?(console.error("Azureservice.del: You must specify the insert object"),null):m(h(a).del(b))},login:function(a){if(!angular.isDefined(a)||-1===d.indexOf(a))throw new Error("Azureservice.login Invalid or no oauth provider listed.");var b=f.login(a).then(function(){sessionStorage.loggedInUser=JSON.stringify(f.currentUser)});return m(b)},logout:function(){sessionStorage.loggedInUser=null,f.logout()},isLoggedIn:function(){return l(f.currentUser)&&l(sessionStorage.loggedInUser)},invokeApi:function(b,c){var d=a.defer(),e=["get","post","put","delete"];if(k(b))return console.error("Azureservice.invokeApi No custom api name specified"),null;if(j(c))c={method:"get"};else if(k(c.method))c.method="get";else if(-1===e.indexOf(c.method.toLowerCase()))return console.error("Azureservice.invokeApi Invalid method type"),null;return f.invokeApi(b,c).done(function(a){d.resolve(a.result)},function(a){d.reject(a)}),d.promise}}}]),angular.module("fireworkNgApp").controller("MainController",["$scope","Azureservice","$location",function(a,b,c){function d(){a.loading=!0,b.query("items",{}).then(function(b){a.fireworkItems=b,a.loading=!1},function(b){console.error("Error: "+b),a.loading=!1})}a.newItem={},a.fireworkItems=[],a.loading=!0,a.editItem=null,a.orderProp="date",a.query=null,d(),a.create=function(){b.insert("items",a.newItem).then(function(){console.log("Insert successful"),d(),a.alerts.push({type:"success",msg:"Item added successfully"})},function(b){console.error("Error: "+b),a.alerts.push({type:"danger",msg:"Item failed to add"})})},a.edit=function(b){a.editItem=b,c.path("/edit/"+b.id)},a.filterByActor=function(b){a.query=b},a.filterByAction=function(b){a.query=b},a.clearFilter=function(){a.query=null},a.delete=function(c){b.del("items",c).then(function(){console.log("Delete successful"),d(),a.alerts.push({type:"success",msg:"Item deleted successfully"})},function(a){console.error("Error: "+a)})},a.isLoggedIn=b.isLoggedIn(),a.alerts=[],a.addAlert=function(){a.alerts.push({msg:"Another alert!"})},a.closeAlert=function(b){a.alerts.splice(b,1)}}]),angular.module("fireworkNgApp").controller("LoginController",["$scope","Azureservice",function(a,b){a.authenticate=function(c){b.login(c).then(function(){console.log("Logged In"),a.isLoggedIn=b.isLoggedIn()},function(a){console.error("Azure Login Error: "+a)})},a.logout=function(){b.logout(),a.isLoggedIn=!1,console.log("Logging Out")},a.isLoggedIn=b.isLoggedIn()}]),angular.module("fireworkNgApp").controller("EditController",["$scope","Azureservice","$location","$routeParams",function(a,b,c,d){function e(){b.getSingleItem("items",a.itemId).then(function(b){console.log("Lookup successful"),a.editItem=b},function(a){console.error("Error: "+a)})}a.loading=!0,a.itemId=d.itemId,a.isLoggedIn=b.isLoggedIn(),a.alerts=[],e(),a.update=function(){b.update("items",a.editItem).then(function(){console.log("Update successful"),a.alerts.push({type:"success",msg:"Item updated successfully"})},function(b){console.error("Error: "+b),a.alerts.push({type:"danger",msg:"Item failed to update"})})},a.addAlert=function(){a.alerts.push({msg:"Another alert!"})},a.closeAlert=function(b){a.alerts.splice(b,1)}}]);
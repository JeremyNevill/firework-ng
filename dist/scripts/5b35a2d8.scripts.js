"use strict";angular.module("fireworkNgApp",["ngCookies","ngResource","ngSanitize","ngRoute","azure-mobile-service.module"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"MainController"}).when("/timeline",{templateUrl:"views/timeline.html",controller:"MainController"}).when("/add",{templateUrl:"views/add.html",controller:"MainController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}],function(a){a.defaults.headers.common["X-ZUMO-APPLICATION"]="NKlaZACMlXLkdoXugaPGoliFvnrpoW34",a.defaults.headers.common["Content-Type"]="Application/json"}),angular.module("azure-mobile-service.module",[]).service("Azureservice",["$q",function(a){var b="https://nevillnet.azure-mobile.net/",c="NKlaZACMlXLkdoXugaPGoliFvnrpoW34",d=["google","twitter","facebook","windowsaccount","windowsazureactivedirectory"],e=WindowsAzure.MobileServiceClient,f=new e(b,c),g=function(){sessionStorage.loggedInUser&&(f.currentUser=JSON.parse(sessionStorage.loggedInUser))};g();var h=function(a){return f.getTable(a)},i=function(a){return"undefined"==typeof a||"object"!=typeof a&&"function"!=typeof a},j=function(a){return k(a)||"object"!=typeof a},k=function(a){return null===a||"undefined"==typeof a},l=function(a){return!k(a)},m=function(b){var c=a.defer();return b.done(function(a){c.resolve(a)},function(a){c.reject(a)}),c.promise};return{query:function(a,b){var c=null;if(k(a))return console.error("Azureservice.query: You must specify a table name"),null;if(angular.isDefined(b)&&angular.isObject(b)){if(i(b.criteria)&&(b.criteria={}),c=h(a).where(b.criteria,b.params),l(b.take)&&angular.isNumber(b.take)&&(c=c.take(b.take)),l(b.skip)&&angular.isNumber(b.take)&&(c=c.skip(b.skip)),angular.isDefined(b.orderBy)&&angular.isArray(b.orderBy))for(var d=b.orderBy,e=0;e<d.length;e++){var f=d[e].column,g=d[e].direction;angular.isDefined(f)&&(angular.isDefined(g)&&"desc"===g.toLowerCase()?c=c.orderByDescending(f):angular.isDefined(f)&&(c=c.orderBy(f)))}angular.isDefined(b.columns)&&angular.isArray(b.columns)&&(c=c.select(b.columns.join()))}else c=h(a).where({});return m(c.includeTotalCount().read())},getAll:function(a){return this.query(a)},insert:function(a,b){return k(a)?(console.error("Azureservice.insert: You must specify a table name"),null):j(b)?(console.error("Azureservice.insert: You must specify the insert object"),null):m(h(a).insert(b))},update:function(a,b){return k(a)?(console.error("Azureservice.update: You must specify a table name"),null):j(b)?(console.error("Azureservice.update: You must specify the insert object"),null):m(h(a).update(b))},del:function(a,b){return k(a)?(console.error("Azureservice.del: You must specify a table name"),null):j(b)?(console.error("Azureservice.del: You must specify the insert object"),null):m(h(a).del(b))},login:function(a){if(!angular.isDefined(a)||-1===d.indexOf(a))throw new Error("Azureservice.login Invalid or no oauth provider listed.");var b=f.login(a).then(function(){sessionStorage.loggedInUser=JSON.stringify(f.currentUser)});return m(b)},logout:function(){sessionStorage.loggedInUser=null,f.logout()},isLoggedIn:function(){return l(f.currentUser)&&l(sessionStorage.loggedInUser)},invokeApi:function(b,c){var d=a.defer(),e=["get","post","put","delete"];if(k(b))return console.error("Azureservice.invokeApi No custom api name specified"),null;if(j(c))c={method:"get"};else if(k(c.method))c.method="get";else if(-1===e.indexOf(c.method.toLowerCase()))return console.error("Azureservice.invokeApi Invalid method type"),null;return f.invokeApi(b,c).done(function(a){d.resolve(a.result)},function(a){d.reject(a)}),d.promise}}}]),angular.module("fireworkNgApp").controller("MainController",["$scope","Azureservice",function(a,b){function c(){b.query("items",{}).then(function(b){a.fireworkItems=b},function(a){console.error("Error: "+a)})}a.newItem={},a.fireworkItems=[],c(),a.create=function(){b.insert("items",a.newItem).then(function(){console.log("Insert successful")},function(a){console.error("Error: "+a)})},a.delete=function(a){b.del("items",a).then(function(){console.log("Delete successful"),c()},function(a){console.error("Error: "+a)})},a.isLoggedIn=b.isLoggedIn()}]),angular.module("fireworkNgApp").controller("LoginController",["$scope","Azureservice",function(a,b){a.authenticate=function(a){b.login(a).then(function(){console.log("Login successful")},function(a){console.error("Azure Error: "+a)})},a.logout=function(){b.logout()},a.isLoggedIn=b.isLoggedIn()}]);